<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               x:Class="BedChangeReminder.Views.Popups.ChangeBedPopup"
               CanBeDismissedByTappingOutsideOfPopup="True">

    <Grid BackgroundColor="{StaticResource Black}" Opacity="0.7" Padding="20">
        <Frame BackgroundColor="{StaticResource White}" 
               CornerRadius="20" 
               BorderColor="DarkSlateGray" 
               Padding="20" 
               HasShadow="True" 
               HorizontalOptions="Center" 
               VerticalOptions="Center"
               MaximumWidthRequest="350"
               Opacity="1.0">

            <ScrollView>
                <StackLayout Spacing="20">
                    <!-- Header -->
                    <Label Text="{Binding BedName, StringFormat='Changed: {0}'}" 
                           FontSize="20"
                           FontAttributes="Bold"
                           VerticalOptions="Center" 
                           HorizontalOptions="Center" 
                           TextColor="DarkSlateGray" />

                    <!-- Current Status -->
                    <Frame BackgroundColor="LightBlue" CornerRadius="10" Padding="15">
                        <StackLayout Spacing="5">
                            <Label Text="Current Status:" FontAttributes="Bold" TextColor="DarkBlue" />
                            <Label Text="{Binding CurrentActionText}" TextColor="DarkBlue" FontSize="14" />
                            <Label Text="{Binding RecommendedActionText}" TextColor="DarkGreen" FontSize="14" FontAttributes="Italic" />
                            <Label Text="{Binding PillowLinerStatusText}" TextColor="DarkBlue" FontSize="13" Margin="0,5,0,0" />
                            <Label Text="{Binding MattressProtectorStatusText}" TextColor="DarkBlue" FontSize="13" />
                        </StackLayout>
                    </Frame>

                    <!-- Action Selection -->
                    <StackLayout Spacing="10">
                        <Label Text="Did you flip or rotate the mattress?" FontAttributes="Bold" TextColor="Black" FontSize="16" />
                        <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                            <Button Grid.Column="0"
                                    Text="Flip" 
                                    Command="{Binding SelectFlipCommand}" 
                                    BackgroundColor="{Binding SelectedAction, Converter={StaticResource BedActionConverter}, ConverterParameter='Flip'}" 
                                    TextColor="White"
                                    FontSize="12"
                                    HeightRequest="40" />
                            <Button Grid.Column="1"
                                    Text="Rotate" 
                                    Command="{Binding SelectRotateCommand}" 
                                    BackgroundColor="{Binding SelectedAction, Converter={StaticResource BedActionConverter}, ConverterParameter='Rotate'}" 
                                    TextColor="White"
                                    FontSize="12"
                                    HeightRequest="40" />
                            <Button Grid.Column="2"
                                    Text="None" 
                                    Command="{Binding SelectNoneCommand}" 
                                    BackgroundColor="{Binding SelectedAction, Converter={StaticResource BedActionConverter}, ConverterParameter='None'}" 
                                    TextColor="White"
                                    FontSize="10"
                                    HeightRequest="40" />
                        </Grid>
                        <Label Text="'None' keeps the previous mattress action for next time" 
                               FontSize="11" 
                               TextColor="DarkGray" 
                               FontAttributes="Italic"
                               HorizontalOptions="Center" />
                    </StackLayout>

                    <!-- Date Override -->
                    <StackLayout Spacing="5">
                        <Label Text="Change Date:" FontAttributes="Bold" TextColor="Black" />
                        <Frame BackgroundColor="White" BorderColor="LightGray" CornerRadius="5" Padding="5">
                            <DatePicker Date="{Binding ChangeDate}" 
                                       Format="dd/MM/yyyy" 
                                       TextColor="Black" 
                                       BackgroundColor="Transparent"
                                       FontSize="16" />
                        </Frame>
                    </StackLayout>

                    <!-- Additional Items -->
                    <StackLayout Spacing="8">
                        <Label Text="Also changed on this date?" FontAttributes="Bold" TextColor="Black" />

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                            <CheckBox Grid.Column="0"
                                      IsChecked="{Binding ChangedMattressProtector}"
                                      Color="Green"
                                      VerticalOptions="Center" />
                            <Label Grid.Column="1"
                                   Text="Mattress protector"
                                   VerticalOptions="Center"
                                   TextColor="Black"
                                   FontSize="15" />
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                            <CheckBox Grid.Column="0"
                                      IsChecked="{Binding ChangedPillowLiner}"
                                      Color="Green"
                                      VerticalOptions="Center" />
                            <Label Grid.Column="1"
                                   Text="Pillow liners"
                                   VerticalOptions="Center"
                                   TextColor="Black"
                                   FontSize="15" />
                        </Grid>
                    </StackLayout>

                    <!-- Action Buttons -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,10,0,0">
                        <Button Grid.Column="0"
                                Text="Confirm" 
                                Command="{Binding ConfirmCommand}" 
                                BackgroundColor="Green" 
                                TextColor="White"
                                FontSize="16"
                                HeightRequest="50"
                                CornerRadius="10" />
                        <Button Grid.Column="1"
                                Text="Cancel" 
                                Command="{Binding CancelCommand}" 
                                BackgroundColor="Red" 
                                TextColor="White"
                                FontSize="16"
                                HeightRequest="50"
                                CornerRadius="10" />
                    </Grid>
                </StackLayout>
            </ScrollView>
        </Frame>
    </Grid>
</toolkit:Popup>